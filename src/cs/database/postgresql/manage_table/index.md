---
date: 2023-09-06
category: PostgreSQL
---

# Manage Table

## Create Table

> Reference: [Create Table](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-create-table/)

```plsql
CREATE TABLE [IF NOT EXISTS] table_name (
  column_name datatype(length) column_constraint,
  column_name datatype(length) column_constraint,
  table_constraints  
);
```

## Select Into

> Reference: [Select Into](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-select-into/)

- 将其他表中满足条件的数据行复制到新表中。

```plsql
SELECT
  select_list
INTO [TEMPORARY | TEMP | UNLOGGED] [TABLE]
  new_table_name
FROM
  table_name
WHERE
  condition;
```

## Create Table As

> Reference: [Create Table As](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-create-table-as/)

- 将其他表的查询结果作为新表的数据。

```plsql
CREATE TABLE new_table_name (renamed_column_list)
AS query;
```

- `CREATE TABLE AS` 和 `SELECT INTO` 的作用相同，优先选择 `CREATE TABLE AS`。

## Serial

> Reference: [Serial](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-serial/)

```plsql
CREATE TABLE table_name(
    column_name SERIAL
);
```

- `SERIAL` 的特点：
  - 从 1 开始自增
  - NOT NULL

- `SERIAL` 类型的大小：
  - `SAMLLSERIAL`：2 字节
  - `SERIAL`：4 字节
  - `BIGSERIAL`：8 字节

- 插入数据：
  - 不提供 `SERIAL` 的列名和数据
  - 提供 `SERIAL` 的列名，使用 `DEFAULT` 代替具体的数据

::: code-tabs
@tab 不提供列名
```plsql
INSERT INTO fruits(name) 
VALUES('apple');
```

@tab 提供列名
```plsql
INSERT INTO fruits(id, name) 
VALUES(DEFAULT, 'apple');
```
:::

## Sequence

> Reference: [Sequence](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-sequences/)

- 创建序列（sequence）：

```plsql
CREATE SEQUENCE [ IF NOT EXISTS ] sequence_name
    [ AS { SMALLINT | INT | BIGINT } ]
    [ INCREMENT [ BY ] increment ]
    [ MINVALUE minvalue | NO MINVALUE ] 
    [ MAXVALUE maxvalue | NO MAXVALUE ]
    [ START [ WITH ] start ] 
    [ CACHE cache ] 
    [ [ NO ] CYCLE ]
    [ OWNED BY { table_name.column_name | NONE } ]
```

- 删除序列：

```plsql
DROP SEQUENCE [ IF EXISTS ] sequence_name
```

- 删除表或者列，会自动删除序列对象。

## Identity Column

> Reference: [Identity Column](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-identity-column/)

- `GENERATED AS IDENTITY` / `GENERATED BY DEFAULT AS IDENTITY`：在插入数据行时，自动为改列赋值一个数字。

- `GENERATED AS IDENTITY` / `GENERATED BY DEFAULT AS IDENTITY` 使用了 Sequence 对象，所以可以指定 sequence option。

```plsql
CREATE TABLE table_name (
  column_name type GENERATED { ALWAYS | BY DEFAULT } AS IDENTITY
  [(sequence_option)]
)
```

- `GENERATED ALWAYS` 和 `GENERATED BY DEFAULT AS IDENTITY` 的区别：
  - `GENERATED ALWAYS`：手动插入值会报错。
  - `GENERATED BY DEFAULT AS IDENTITY`：手动插入值不会报错。

- 添加标识列（标识列之前的类型必须为 `NOT NULL`）：

```plsql
ALTER TABLE table_name
ALTER COLUMN column_name
ADD GENERATED { ALWAYS | BY DEFAULT } AS IDENTITY
[(sequence_option)]
```

- 修改标识列：

```plsql
ALTER TABLE table_name 
ALTER COLUMN column_name 
{ SET GENERATED { ALWAYS| BY DEFAULT } | 
  SET sequence_option | RESTART [ [ WITH ] restart ] }
```

- 删除 `GENERATED ALWAYS` / `GENERATED BY DEFAULT AS IDENTITY` 约束：

```plsql
ALTER TABLE table_name
ALTER COLUMN column_name
DROP IDENTITY [ IF EXISTS ]
```

## Alter Table

> Reference: [Alter Table](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-alter-table/)

- 设置或删除列的默认值：

```plsql
ALTER TABLE table_name 
ALTER COLUMN column_name 
[SET DEFAULT value | DROP DEFAULT];
```

- 设置或删除 `NOT NULL` 限制：

```plsql
ALTER TABLE table_name 
ALTER COLUMN column_name 
[SET NOT NULL| DROP NOT NULL];
```

- 添加 `CHECK` 限制：

```plsql
ALTER TABLE table_name 
ADD CHECK expression;
```

- 添加限制：

```plsql
ALTER TABLE table_name 
ADD CONSTRAINT constraint_name constraint_definition;
```

- 重命名表：

```plsql
ALTER TABLE table_name 
RENAME TO new_table_name;
```

## Rename Table

> Reference: [Rename Table](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-rename-table/)

- 重命名表名：

```plsql
ALTER TABLE [IF EXISTS] table_name
RENAME TO new_table_name;
```

## Add Column

> Reference: [Add Column](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-add-column/)

- 增加列：

```plsql
ALTER TABLE table_name
ADD COLUMN new_column_name data_type constraint;
```

- 新增加的列自动成为最后一列，无法指定在列中的顺序。

## Drop Column

> Reference: [Drop Column](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-drop-column/)

- 删除表的一列时，PostgreSQL 会自动删除与该列有关的索引和限制。

- 当删除被其他数据库对象（例如：view, trigger, stored procedure）使用的列时，需要使用 `CASCADE` 选项，这个选项会删除列和使用改列的对象。

```plsql
ALTER TABLE table_name 
DROP COLUMN column_name CASCADE;
```

- 删除多列：

```plsql
ALTER TABLE table_name
DROP COLUMN column_name1,
DROP COLUMN column_name2,
...;
```

## Change Column Data Type

> Reference: [Change Column Data Type](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-change-column-type/)

- 修改列的数据类型：

```plsql
ALTER TABLE table_name
ALTER COLUMN column_name [SET DATA] TYPE new_data_type;
```

- 如果列的数据类型无法自动转换，则需要使用 `USING column_name::new_data_type`：

```plsql
ALTER TABLE table_name
ALTER COLUMN column_name TYPE new_data_type
USING column_name::new_data_type
```

## Rename Column

> Reference: [Rename Column](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-rename-column/)

- 重命名列：

```plsql
ALTER TABLE table_name 
RENAME COLUMN column_name
TO new_column_name;
```

- 重命名多列：

```plsql
ALTER TABLE table_name
RENAME COLUMN column_name1 TO new_column_name1;

ALTER TABLE table_name
RENAME COLUMN column_name2 TO new_column_name2;
```

- 如果列被其他对象所引用，那么重命名列之后 PostgreSQL 会自动重命名引用改列的列名。

## Drop Table

> Reference: [Drop Table](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-drop-table/)

- 删除表：

```plsql
DROP TABLE [IF EXISTS] table_name 
[CASCADE | RESTRICT];
```

- `CASCADE` 与 `RESTRICT`：
  - `CASCADE`：删除表与依赖该表的的对象。
  - `RESTRICT`：如果有对象依赖该表，则拒绝删除该表和依赖的对象。`RESTRICT` 是默认选项。

- 删除多个表：

```plsql
DROP TABLE [IF EXISTS] 
   table_name_1,
   table_name_2,
   ...
[CASCADE | RESTRICT];
```

## Truncate Table

> Reference: [Truncate Table](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-truncate-table/)

- 删除表的所有数据：

```plsql
TRUNCATE TABLE table_name;
```

- 在删除表数据方面，`TRUNCATE` 比 `DELETE` 更高效，因为不需要扫描表。

- 删除表的所有数据，并重新开始标识。默认是 `CONTINUE IDENTITY`：

```plsql
TRUNCATE TABLE table_name 
RESTART IDENTITY;
```

- 删除多个表的数据：

```plsql
TRUNCATE TABLE 
    table_name1, 
    table_name2,
    ...;
```


