import{_ as i,W as o,X as p,Y as n,Z as a,$ as e,a0 as t,C as c}from"./framework-0d71bc9d.js";const l="/blog/assets/check-package-and-subpackage-information-ad84af52.png",r="/blog/assets/preload-8ad2cc92.png",u={},d=n("h1",{id:"分包",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#分包","aria-hidden":"true"},"#"),a(" 分包")],-1),k=n("h2",{id:"原因",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#原因","aria-hidden":"true"},"#"),a(" 原因")],-1),v={href:"https://developers.weixin.qq.com/miniprogram/dev/framework/performance/tips/start_optimizeA.html",target:"_blank",rel:"noopener noreferrer"},h=n("ul",null,[n("li",null,"主包的体积上限为 2M，如果超过 2M 需要进行分包。"),n("li",null,"可以显著减少启动时需要下载的代码包大小。")],-1),m=n("h2",{id:"使用分包",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#使用分包","aria-hidden":"true"},"#"),a(" 使用分包")],-1),g={href:"https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/basic.html",target:"_blank",rel:"noopener noreferrer"},b=t(`<h3 id="配置" tabindex="-1"><a class="header-anchor" href="#配置" aria-hidden="true">#</a> 配置</h3><ul><li>在 <code>app.json</code> 中定义 <code>subpackages</code> 字段，在该字段中定义分包。</li></ul><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;subpackages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packageA&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;pages/cat/cat&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;pages/dog/dog&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在 <code>微信开发者工具-&gt;详情-&gt;基本信息-&gt;代码依赖分析</code> 中可以查看主包和分包的信息。</li></ul><figure><img src="`+l+`" alt="查看主包和分包的信息" tabindex="0" loading="lazy"><figcaption>查看主包和分包的信息</figcaption></figure><h3 id="打包原则" tabindex="-1"><a class="header-anchor" href="#打包原则" aria-hidden="true">#</a> 打包原则</h3><ul><li><code>subpackages</code> 配置路径外的目录将被打包到主包中。</li><li><code>subpackage</code> 的根目录不能是另外一个 <code>subpackage</code> 内的子目录。</li><li><code>tabBar</code> 页面必须在主包内。</li></ul><h3 id="引用原则" tabindex="-1"><a class="header-anchor" href="#引用原则" aria-hidden="true">#</a> 引用原则</h3><ul><li>packageA 无法 require packageB JS 文件，但可以 require 主包、packageA 内的 JS 文件；使用分包异步化时不受此条限制。</li><li>packageA 无法 import packageB 的 template，但可以 require 主包、packageA 内的 template。</li><li>packageA 无法使用 packageB 的资源，但可以使用主包、packageA 内的资源。</li></ul><h2 id="独立分包" tabindex="-1"><a class="header-anchor" href="#独立分包" aria-hidden="true">#</a> 独立分包</h2><ul><li>独立分包是小程序中一种特殊的分包，可以独立于主包和其他分包运行。从独立分包中页面进入小程序时，不需要下载主包。当用户进入普通分包或主包内页面时，主包才会被下载。</li></ul><h3 id="限制" tabindex="-1"><a class="header-anchor" href="#限制" aria-hidden="true">#</a> 限制</h3><ul><li>独立分包不能依赖主包和其他分包中的内容。</li><li>主包的 <code>app.wxss</code> 不会应用到独立分包中。</li><li><code>App</code> 只能在主包内定义，独立分包中不能定义 <code>App</code>。</li><li>独立分包不支持插件。</li></ul><h2 id="分包预下载" tabindex="-1"><a class="header-anchor" href="#分包预下载" aria-hidden="true">#</a> 分包预下载</h2><h3 id="概念" tabindex="-1"><a class="header-anchor" href="#概念" aria-hidden="true">#</a> 概念</h3><ul><li>进入某个页面时，提前下载可能需要的分包，提升进入后续分包页面时的启动速度。</li></ul><h3 id="配置-1" tabindex="-1"><a class="header-anchor" href="#配置-1" aria-hidden="true">#</a> 配置</h3><ul><li>配置 <code>app.json</code> 中的 <code>preloadRule</code>。</li></ul><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;preloadRule&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;pages/index/index&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packageA&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+r+'" alt="预下载名为 packageA 的分包" tabindex="0" loading="lazy"><figcaption>预下载名为 packageA 的分包</figcaption></figure><h2 id="分包异步化" tabindex="-1"><a class="header-anchor" href="#分包异步化" aria-hidden="true">#</a> 分包异步化</h2>',21),f={href:"https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/async.html",target:"_blank",rel:"noopener noreferrer"},q=t(`<h3 id="概念-1" tabindex="-1"><a class="header-anchor" href="#概念-1" aria-hidden="true">#</a> 概念</h3><ul><li>分包异步化可以让分包使用其他分包中的组件和 JavaScript 文件。</li></ul><h3 id="组件" tabindex="-1"><a class="header-anchor" href="#组件" aria-hidden="true">#</a> 组件</h3><ul><li>一个分包使用其他分包的自定义组件时，由于其他分包还未下载或注入，其他分包的组件处于不可用的状态。通过为其他分包的自定义组件设置占位组件，我们可以先渲染占位组件作为替代，在分包下载完成后再进行替换。</li></ul><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;list&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/packageA/components/list/list&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;componentPlaceholder&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;list&quot;</span><span class="token operator">:</span> <span class="token string">&quot;view&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="javascript-文件" tabindex="-1"><a class="header-anchor" href="#javascript-文件" aria-hidden="true">#</a> JavaScript 文件</h3><ul><li>一个分包引用其他分包的 JS 文件时，为了不让下载阻塞代码运行，我们需要异步获取引用结果。</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// packageA/common/utility.js</span>
<span class="token keyword">function</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hi&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  greet<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// packageB/pages/person/person.js</span>
<span class="token keyword">let</span> utility
require
  <span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token string">&#39;/packageA/common/utility.js&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mod</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> utility <span class="token operator">=</span> mod<span class="token punctuation">)</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    utility<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9);function _(x,y){const s=c("ExternalLinkIcon");return o(),p("div",null,[d,k,n("blockquote",null,[n("p",null,[a("Reference: "),n("a",v,[a("使用分包的原因"),e(s)])])]),h,m,n("blockquote",null,[n("p",null,[a("Reference: "),n("a",g,[a("使用分包"),e(s)])])]),b,n("blockquote",null,[n("p",null,[a("Reference: "),n("a",f,[a("分包异步化"),e(s)])])]),q])}const A=i(u,[["render",_],["__file","index.html.vue"]]);export{A as default};
