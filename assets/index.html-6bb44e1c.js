import{_ as p,W as d,X as k,Y as n,Z as s,$ as e,a1 as t,a0 as r,C as u}from"./framework-0d71bc9d.js";const _="/blog/assets/entry_a_wrapper-c76da7c8.png",g="/blog/assets/module_a_wrapper-6aa80cf9.png",h="/blog/assets/two_modules_wrapper-4f28f547.png",m="/blog/assets/multi_chunks-013b2d87.png",b={},v=n("h1",{id:"scope-hoisting",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#scope-hoisting","aria-hidden":"true"},"#"),s(" Scope Hoisting")],-1),f=n("h2",{id:"problem",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#problem","aria-hidden":"true"},"#"),s(" Problem")],-1),j=n("p",null,"Reference:",-1),y={href:"https://juejin.cn/book/7115598540721618944?utm_source=course_list",target:"_blank",rel:"noopener noreferrer"},w={href:"https://webpack.js.org/plugins/module-concatenation-plugin/",target:"_blank",rel:"noopener noreferrer"},x=n("ul",null,[n("li",null,"webpack 会将每个模块用函数包裹起来，这些函数会导致运行速度变慢。下列代码会被编译为如图所示的结果：")],-1),C=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" greet "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./module_a'"),s(`
console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"greet"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),M=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"greet"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token string"},"'hello world'"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),S=n("figure",null,[n("img",{src:_,alt:"entry_a.js 被函数包裹",height:"200",tabindex:"0",loading:"lazy"}),n("figcaption",null,"entry_a.js 被函数包裹")],-1),E=n("figure",null,[n("img",{src:g,alt:"module_a.js 被函数包裹",height:"300",tabindex:"0",loading:"lazy"}),n("figcaption",null,"module_a.js 被函数包裹")],-1),A=n("h2",{id:"solution",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#solution","aria-hidden":"true"},"#"),s(" Solution")],-1),P=n("p",null,"Reference:",-1),z={href:"https://juejin.cn/book/7115598540721618944?utm_source=course_list",target:"_blank",rel:"noopener noreferrer"},B={href:"https://webpack.js.org/plugins/module-concatenation-plugin/",target:"_blank",rel:"noopener noreferrer"},q=n("ul",null,[n("li",null,[n("code",null,"scope hoisting"),s(" 可以让多个模块被同一个函数包裹，提高运行速度。")])],-1),R=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" greet "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./module_a'"),s(`
console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"greet"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),W=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"greet"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token string"},"'hello world'"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),N=n("figure",null,[n("img",{src:h,alt:"entry_a.js 和 module_a.js 被同一个函数包裹",height:"400",tabindex:"0",loading:"lazy"}),n("figcaption",null,"entry_a.js 和 module_a.js 被同一个函数包裹")],-1),V=n("h2",{id:"usage",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#usage","aria-hidden":"true"},"#"),s(" Usage")],-1),T=n("p",null,"References",-1),F={href:"https://webpack.js.org/plugins/module-concatenation-plugin/",target:"_blank",rel:"noopener noreferrer"},I=r('<ul><li>启动 <code>scope hosting</code> 的方式（前两种方式本质上都是调用 <code>ModuleConcatenationPlugin</code> 插件）： <ul><li><code>mode: &#39;production&#39;</code></li><li><code>optimization.concatenateModules: true</code></li><li><code>new webpack.optimize.ModuleConcatenationPlugin()</code></li></ul></li></ul><h2 id="only-esm" tabindex="-1"><a class="header-anchor" href="#only-esm" aria-hidden="true">#</a> Only ESM</h2>',2),L=n("p",null,"References",-1),H={href:"https://babeljs.io/docs/babel-preset-env#modules",target:"_blank",rel:"noopener noreferrer"},J={href:"https://juejin.cn/book/7115598540721618944?utm_source=course_list",target:"_blank",rel:"noopener noreferrer"},O=r(`<ul><li><p><code>ModuleConcatenationPlugin</code> 仅支持 ESM，因此需要将 Babel 的 <code>modules</code> 设置为 <code>false</code>，即 Babel 不会将 ESM 转换为其他形式，浏览器最终运行的是 ESM。</p></li><li><p>许多第三方包默认导出的格式是兼容性更好的 CommonJS，但是这会导致 scope hoisting 失效。配置 <code>mainFields</code> 可以尝试引入框架的 ESM 版本：</p></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mainFields</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;jsnext:main&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;browser&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;main&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="multiple-chunks" tabindex="-1"><a class="header-anchor" href="#multiple-chunks" aria-hidden="true">#</a> Multiple Chunks</h2>`,3),U=n("p",null,"References",-1),X={href:"https://juejin.cn/book/7115598540721618944?utm_source=course_list",target:"_blank",rel:"noopener noreferrer"},Y=n("ul",null,[n("li",null,[s("当多个 chunk 引用同一个模块时，为了避免重复写入相同的代码，scope hoisting 会失效。"),n("code",null,"entry_a.js"),s(" 和 "),n("code",null,"entry_b.js"),s(" 引用 "),n("code",null,"module_a.js"),s("，scope hoisting 会失效。")])],-1),Z=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" greet "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./module_a'"),s(`
console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'entry_a'"),n("span",{class:"token punctuation"},")"),s(`
console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"greet"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),$=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" greet "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./module_a'"),s(`
console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'entry_a'"),n("span",{class:"token punctuation"},")"),s(`
console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"greet"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),D=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"greet"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token string"},"'hello world'"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),G=n("figure",null,[n("img",{src:m,alt:"多个 chunk 引用同一个模块时，scope hoisting 会失效",height:"300",tabindex:"0",loading:"lazy"}),n("figcaption",null,"多个 chunk 引用同一个模块时，scope hoisting 会失效")],-1);function K(Q,nn){const a=u("ExternalLinkIcon"),i=u("CodeTabs");return d(),k("div",null,[v,f,n("blockquote",null,[j,n("ul",null,[n("li",null,[n("a",y,[s("Webpack5 核心原理与应用实践: chapter18"),e(a)])]),n("li",null,[n("a",w,[s("ModuleConcatenationPlugin"),e(a)])])])]),x,e(i,{id:"30",data:[{title:"entry_a.js"},{title:"module_a.js"}]},{tab0:t(({title:o,value:l,isActive:c})=>[C]),tab1:t(({title:o,value:l,isActive:c})=>[M]),_:1},8,["data"]),S,E,A,n("blockquote",null,[P,n("ul",null,[n("li",null,[n("a",z,[s("Webpack5 核心原理与应用实践: chapter18"),e(a)])]),n("li",null,[n("a",B,[s("ModuleConcatenationPlugin"),e(a)])])])]),q,e(i,{id:"71",data:[{title:"entry_a.js"},{title:"module_a.js"}]},{tab0:t(({title:o,value:l,isActive:c})=>[R]),tab1:t(({title:o,value:l,isActive:c})=>[W]),_:1},8,["data"]),N,V,n("blockquote",null,[T,n("ul",null,[n("li",null,[n("a",F,[s("ModuleConcatenationPlugin"),e(a)])])])]),I,n("blockquote",null,[L,n("ul",null,[n("li",null,[n("a",H,[s("Babel: disable modules option"),e(a)])]),n("li",null,[n("a",J,[s("Webpack5 核心原理与应用实践: chapter18"),e(a)])])])]),O,n("blockquote",null,[U,n("ul",null,[n("li",null,[n("a",X,[s("Webpack5 核心原理与应用实践: chapter18"),e(a)])])])]),Y,e(i,{id:"176",data:[{title:"entry_a.js"},{title:"entry_b.js"},{title:"module_a.js"}]},{tab0:t(({title:o,value:l,isActive:c})=>[Z]),tab1:t(({title:o,value:l,isActive:c})=>[$]),tab2:t(({title:o,value:l,isActive:c})=>[D]),_:1},8,["data"]),G])}const en=p(b,[["render",K],["__file","index.html.vue"]]);export{en as default};
